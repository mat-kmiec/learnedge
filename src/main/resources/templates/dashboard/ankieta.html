<!DOCTYPE html>
<html lang="pl">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="_csrf" th:content="${_csrf.token}" />
  <meta name="_csrf_header" th:content="${_csrf.headerName}" />
  <title>LearnEdge â€“ Ankieta AI</title>
  <link rel="icon" type="image/x-icon" th:href="@{/img/favicon.ico}" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <link th:href="@{/css/pages/dashboard.css}" rel="stylesheet" />
  <style>
    .question-container {
      display: none;
      min-height: 400px;
    }

    .question-container.active {
      display: block;
      animation: fadeIn 0.4s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateX(20px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .progress-bar-container {
      margin-bottom: 40px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
    }

    .progress {
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
    }

    .question-number {
      font-size: 0.85rem;
      color: var(--accent-color);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 15px;
    }

    .question-container h5 {
      font-size: 1.5rem;
      line-height: 1.5;
      color: #fff;
      margin-bottom: 30px;
    }

    .answer-option {
      display: block;
      padding: 18px 24px;
      margin: 12px 0;
      border: 2px solid rgba(255, 255, 255, 0.15);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.25s ease;
      background: rgba(255, 255, 255, 0.05);
      font-size: 1.05rem;
      position: relative;
      overflow: hidden;
    }

    .answer-option::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--accent-color);
      transform: scaleY(0);
      transition: transform 0.25s ease;
    }

    .answer-option:hover {
      border-color: var(--accent-color);
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(4px);
    }

    .answer-option:hover::before {
      transform: scaleY(1);
    }

    .answer-option.selected {
      border-color: var(--accent-color);
      background: linear-gradient(135deg, rgba(var(--accent-rgb), 0.25), rgba(var(--accent-rgb), 0.15));
      box-shadow: 0 4px 20px rgba(var(--accent-rgb), 0.3);
    }

    .answer-option.selected::before {
      transform: scaleY(1);
    }

    .answer-option input[type="radio"] {
      margin-right: 15px;
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: var(--accent-color);
    }

    .answer-option label {
      cursor: pointer;
      user-select: none;
    }

    .navigation-buttons {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      margin-top: 40px;
      flex-wrap: wrap;
    }

    .btn-nav {
      flex: 1;
      min-width: 120px;
      padding: 14px 20px;
      font-size: 1rem;
      font-weight: 500;
      border-radius: 10px;
      transition: all 0.3s ease;
    }

    /* Nowa klasa do obramowania */
    .btn-bordered {
      border: 2px solid rgba(255, 255, 255, 0.3) !important;
    }
    
    .btn-bordered:hover {
      border-color: #ffffff !important;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .btn-nav:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .btn-outline-secondary {
      background: transparent;
      border: 2px solid rgba(255, 255, 255, 0.2);
      color: rgba(255, 255, 255, 0.8);
    }

    .btn-outline-secondary:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.3);
      color: #fff;
    }

    textarea.form-control {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.15);
      color: #fff;
      padding: 15px;
      font-size: 1rem;
      border-radius: 10px;
      resize: vertical;
    }

    textarea.form-control:focus {
      background: rgba(255, 255, 255, 0.08);
      border-color: var(--accent-color);
      box-shadow: 0 0 0 0.2rem rgba(var(--accent-rgb), 0.25);
    }

    textarea.form-control::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    /* Toast notification system */
    .toast-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-width: 400px;
    }

    .toast-notification {
      display: flex;
      align-items: center;
      gap: 15px;
      background: linear-gradient(135deg, rgba(30, 30, 30, 0.98), rgba(20, 20, 20, 0.98));
      border: 2px solid var(--accent-color);
      border-radius: 12px;
      padding: 16px 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 20px rgba(var(--accent-rgb), 0.3);
      backdrop-filter: blur(10px);
      animation: slideInRight 0.4s ease-out;
      color: #fff;
    }

    .toast-notification.toast-hide {
      animation: slideOutRight 0.4s ease-out forwards;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(400px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOutRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }

      to {
        transform: translateX(400px);
        opacity: 0;
      }
    }

    .toast-logo {
      flex-shrink: 0;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      background: var(--accent-color);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .toast-logo img {
      width: 28px;
      height: 28px;
      object-fit: contain;
    }

    .toast-message {
      flex: 1;
      font-size: 0.95rem;
      line-height: 1.4;
    }

    .toast-close {
      flex-shrink: 0;
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.6);
      font-size: 1.2rem;
      cursor: pointer;
      padding: 0;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s ease;
    }

    .toast-close:hover {
      color: #fff;
    }
  </style>
</head>

<body>
  <div id="toastContainer" class="toast-container"></div>

  <div th:replace="~{fragments/nav :: navbar}"></div>

  <div class="container py-5">
    <div class="dashboard-container">
      <div class="dashboard-header text-center mb-4">
        <h1 class="mb-2">Ankieta AI â€“ Poznaj swÃ³j styl uczenia siÄ™</h1>
        <p class="text-light opacity-75 small mb-0">
          Odpowiedz na pytania, a AI dopasuje najlepszy styl nauki dla Ciebie
        </p>

        <div th:if="${aiAvailable}" class="alert alert-success mt-3">
          <i class="bi bi-robot me-2"></i>
          AI jest gotowe do analizy!
        </div>
        <div th:replace="~{fragments/alerts :: alertMessages}"></div>
      </div>

      <div class="progress-bar-container">
        <div class="d-flex justify-content-between mb-2">
          <span class="small">PostÄ™p</span>
          <span class="small"><span id="currentQuestion">1</span> / <span id="totalQuestions">13</span></span>
        </div>
        <div class="progress">
          <div id="progressBar" class="progress-bar bg-accent" role="progressbar" style="width: 8%"></div>
        </div>
      </div>

      <form id="learningStyleForm">
        <div class="question-container active" data-question="1">
          <div class="question-number">Pytanie 1 z 20</div>
          <h5 class="fw-bold mb-4">Kiedy uczysz siÄ™ czegoÅ› nowego, najÅ‚atwiej zapamiÄ™tujesz gdy...</h5>
          <label class="answer-option">
            <input type="radio" name="q1" value="visual" />
            widzÄ™ schemat lub obrazek
          </label>
          <label class="answer-option">
            <input type="radio" name="q1" value="auditory" />
            ktoÅ› mi to tÅ‚umaczy
          </label>
          <label class="answer-option">
            <input type="radio" name="q1" value="kinesthetic" />
            mogÄ™ to sam wyprÃ³bowaÄ‡
          </label>
        </div>

        <div class="question-container" data-question="2">
          <div class="question-number">Pytanie 2 z 20</div>
          <h5 class="fw-bold mb-4">Co najczÄ™Å›ciej robisz w czasie nauki?</h5>
          <label class="answer-option">
            <input type="radio" name="q2" value="visual" />
            robiÄ™ notatki i rysunki
          </label>
          <label class="answer-option">
            <input type="radio" name="q2" value="auditory" />
            czytam na gÅ‚os lub sÅ‚ucham nagraÅ„
          </label>
          <label class="answer-option">
            <input type="radio" name="q2" value="kinesthetic" />
            gestykulujÄ™ lub poruszam siÄ™
          </label>
        </div>

        <div class="question-container" data-question="3">
          <div class="question-number">Pytanie 3 z 20</div>
          <h5 class="fw-bold mb-4">Podczas prezentacji wolisz gdy:</h5>
          <label class="answer-option">
            <input type="radio" name="q3" value="visual" />
            pokazywane sÄ… slajdy i grafiki
          </label>
          <label class="answer-option">
            <input type="radio" name="q3" value="auditory" />
            prowadzÄ…cy mÃ³wi pÅ‚ynnie i wyraÅºnie
          </label>
          <label class="answer-option">
            <input type="radio" name="q3" value="kinesthetic" />
            moÅ¼esz coÅ› robiÄ‡ rÄ™kami lub poruszaÄ‡ siÄ™
          </label>
        </div>

        <div class="question-container" data-question="4">
          <div class="question-number">Pytanie 4 z 20</div>
          <h5 class="fw-bold mb-4">Kiedy tÅ‚umaczysz drogÄ™ komuÅ›:</h5>
          <label class="answer-option">
            <input type="radio" name="q4" value="visual" />
            rysujesz mapkÄ™ lub pokazujesz
          </label>
          <label class="answer-option">
            <input type="radio" name="q4" value="auditory" />
            dokÅ‚adnie opisujesz sÅ‚owami
          </label>
          <label class="answer-option">
            <input type="radio" name="q4" value="kinesthetic" />
            gestykulujesz i wskazujesz kierunki
          </label>
        </div>

        <div class="question-container" data-question="5">
          <div class="question-number">Pytanie 5 z 20</div>
          <h5 class="fw-bold mb-4">W wolnym czasie najchÄ™tniej:</h5>
          <label class="answer-option">
            <input type="radio" name="q5" value="visual" />
            czytam ksiÄ…Å¼ki lub oglÄ…dam filmy
          </label>
          <label class="answer-option">
            <input type="radio" name="q5" value="auditory" />
            sÅ‚ucham muzyki lub podcastÃ³w
          </label>
          <label class="answer-option">
            <input type="radio" name="q5" value="kinesthetic" />
            uprawiam sport lub hobby manualne
          </label>
        </div>

        <div class="question-container" data-question="6">
          <div class="question-number">Pytanie 6 z 20</div>
          <h5 class="fw-bold mb-4">Gdy muszÄ™ zapamiÄ™taÄ‡ numer telefonu:</h5>
          <label class="answer-option">
            <input type="radio" name="q6" value="visual" />
            zapisujÄ™ go lub wyobraÅ¼am sobie cyfry
          </label>
          <label class="answer-option">
            <input type="radio" name="q6" value="auditory" />
            powtarzam go sobie na gÅ‚os
          </label>
          <label class="answer-option">
            <input type="radio" name="q6" value="kinesthetic" />
            wystukujÄ™ rytm cyframi
          </label>
        </div>

        <div class="question-container" data-question="7">
          <div class="question-number">Pytanie 7 z 20</div>
          <h5 class="fw-bold mb-4">Podczas nauki jÄ™zyka obcego wolÄ™:</h5>
          <label class="answer-option">
            <input type="radio" name="q7" value="visual" />
            czytaÄ‡ teksty i oglÄ…daÄ‡ napisy
          </label>
          <label class="answer-option">
            <input type="radio" name="q7" value="auditory" />
            sÅ‚uchaÄ‡ nagraÅ„ i rozmawiaÄ‡
          </label>
          <label class="answer-option">
            <input type="radio" name="q7" value="kinesthetic" />
            Ä‡wiczyÄ‡ przez pisanie i gesty
          </label>
        </div>

        <div class="question-container" data-question="8">
          <div class="question-number">Pytanie 8 z 20</div>
          <h5 class="fw-bold mb-4">W sklepie najÅ‚atwiej znajdujÄ™ produkty gdy:</h5>
          <label class="answer-option">
            <input type="radio" name="q8" value="visual" />
            mam listÄ™ zapisanÄ… lub pamiÄ™tam gdzie sÄ…
          </label>
          <label class="answer-option">
            <input type="radio" name="q8" value="auditory" />
            pytam sprzedawcÄ™
          </label>
          <label class="answer-option">
            <input type="radio" name="q8" value="kinesthetic" />
            przechodzÄ™ po sklepie i szukam
          </label>
        </div>

        <div class="question-container" data-question="9">
          <div class="question-number">Pytanie 9 z 20</div>
          <h5 class="fw-bold mb-4">Przy rozwiÄ…zywaniu problemÃ³w matematycznych:</h5>
          <label class="answer-option">
            <input type="radio" name="q9" value="visual" />
            rysujÄ™ schematy i wykresy
          </label>
          <label class="answer-option">
            <input type="radio" name="q9" value="auditory" />
            dyskutujÄ™ z innymi lub mÃ³wiÄ™ na gÅ‚os
          </label>
          <label class="answer-option">
            <input type="radio" name="q9" value="kinesthetic" />
            uÅ¼ywam klockÃ³w, liczydÅ‚a lub palcÃ³w
          </label>
        </div>

        <div class="question-container" data-question="10">
          <div class="question-number">Pytanie 10 z 20</div>
          <h5 class="fw-bold mb-4">Gdy siÄ™ stresujÄ™ przed egzaminem:</h5>
          <label class="answer-option">
            <input type="radio" name="q10" value="visual" />
            przeglÄ…dam notatki i podsumowania
          </label>
          <label class="answer-option">
            <input type="radio" name="q10" value="auditory" />
            rozmawiam z kimÅ› o materiale
          </label>
          <label class="answer-option">
            <input type="radio" name="q10" value="kinesthetic" />
            chodzÄ™ lub ruszam siÄ™
          </label>
        </div>

        <div class="question-container" data-question="11">
          <div class="question-number">Pytanie 11 z 20</div>
          <h5 class="fw-bold mb-4">Najlepiej koncentrujÄ™ siÄ™ gdy:</h5>
          <label class="answer-option">
            <input type="radio" name="q11" value="visual" />
            mam uporzÄ…dkowane miejsce pracy
          </label>
          <label class="answer-option">
            <input type="radio" name="q11" value="auditory" />
            jest cicho lub gra spokojna muzyka
          </label>
          <label class="answer-option">
            <input type="radio" name="q11" value="kinesthetic" />
            mogÄ™ siÄ™ ruszaÄ‡ lub mam coÅ› w rÄ™kach
          </label>
        </div>

        <div class="question-container" data-question="12">
          <div class="question-number">Pytanie 12 z 20</div>
          <h5 class="fw-bold mb-4">Podczas robienia notatek:</h5>
          <label class="answer-option">
            <input type="radio" name="q12" value="visual" />
            uÅ¼ywam kolorÃ³w, podkreÅ›leÅ„ i schematÃ³w
          </label>
          <label class="answer-option">
            <input type="radio" name="q12" value="auditory" />
            przepisujÄ™ lub nagrywam wÅ‚asne tÅ‚umaczenia
          </label>
          <label class="answer-option">
            <input type="radio" name="q12" value="kinesthetic" />
            piszÄ™ szybko, czÄ™sto bazgroÅ‚ami
          </label>
        </div>

        <div class="question-container" data-question="13">
          <div class="question-number">Pytanie 13 z 20</div>
          <h5 class="fw-bold mb-4">Przy montaÅ¼u mebli z instrukcjÄ…:</h5>
          <label class="answer-option">
            <input type="radio" name="q13" value="visual" />
            dokÅ‚adnie studiujÄ™ rysunki
          </label>
          <label class="answer-option">
            <input type="radio" name="q13" value="auditory" />
            proszÄ™ kogoÅ› o pomoc lub tÅ‚umaczenie
          </label>
          <label class="answer-option">
            <input type="radio" name="q13" value="kinesthetic" />
            zaczynam skÅ‚adaÄ‡ metodÄ… prÃ³b i bÅ‚Ä™dÃ³w
          </label>
        </div>

        <div class="question-container" data-question="14">
          <div class="question-number">Pytanie 14 z 20</div>
          <h5 class="fw-bold mb-4">Kiedy uczÄ™ siÄ™ nowego sÅ‚owa:</h5>
          <label class="answer-option">
            <input type="radio" name="q14" value="visual" />
            widzÄ™ je napisane i wizualizujÄ™
          </label>
          <label class="answer-option">
            <input type="radio" name="q14" value="auditory" />
            powtarzam je gÅ‚oÅ›no kilka razy
          </label>
          <label class="answer-option">
            <input type="radio" name="q14" value="kinesthetic" />
            zapisujÄ™ je lub ukÅ‚adam z liter
          </label>
        </div>

        <div class="question-container" data-question="15">
          <div class="question-number">Pytanie 15 z 20</div>
          <h5 class="fw-bold mb-4">Podczas oglÄ…dania filmu edukacyjnego:</h5>
          <label class="answer-option">
            <input type="radio" name="q15" value="visual" />
            koncentrujÄ™ siÄ™ na obrazach i animacjach
          </label>
          <label class="answer-option">
            <input type="radio" name="q15" value="auditory" />
            najbardziej pamiÄ™tam komentarz lektora
          </label>
          <label class="answer-option">
            <input type="radio" name="q15" value="kinesthetic" />
            chcÄ™ sprÃ³bowaÄ‡ tego, co pokazano
          </label>
        </div>

        <div class="question-container" data-question="16">
          <div class="question-number">Pytanie 16 z 20</div>
          <h5 class="fw-bold mb-4">Gdy spotykam nowÄ… osobÄ™, najlepiej zapamiÄ™tam:</h5>
          <label class="answer-option">
            <input type="radio" name="q16" value="visual" />
            jej wyglÄ…d i twarz
          </label>
          <label class="answer-option">
            <input type="radio" name="q16" value="auditory" />
            jej imiÄ™ i gÅ‚os
          </label>
          <label class="answer-option">
            <input type="radio" name="q16" value="kinesthetic" />
            jak siÄ™ czuÅ‚em podczas spotkania
          </label>
        </div>

        <div class="question-container" data-question="17">
          <div class="question-number">Pytanie 17 z 20</div>
          <h5 class="fw-bold mb-4">Podczas czytania ksiÄ…Å¼ki wolÄ™:</h5>
          <label class="answer-option">
            <input type="radio" name="q17" value="visual" />
            wyobraÅ¼aÄ‡ sobie scenÄ™ w myÅ›lach
          </label>
          <label class="answer-option">
            <input type="radio" name="q17" value="auditory" />
            czytaÄ‡ ze sÅ‚yszeniem sÅ‚Ã³w w gÅ‚owie
          </label>
          <label class="answer-option">
            <input type="radio" name="q17" value="kinesthetic" />
            czuÄ‡ emocje i napiÄ™cie akcji
          </label>
        </div>

        <div class="question-container" data-question="18">
          <div class="question-number">Pytanie 18 z 20</div>
          <h5 class="fw-bold mb-4">Kiedy muszÄ™ zapamiÄ™taÄ‡ listÄ™ rzeczy do zrobienia:</h5>
          <label class="answer-option">
            <input type="radio" name="q18" value="visual" />
            piszÄ™ listÄ™ lub robiÄ™ mind mapÄ™
          </label>
          <label class="answer-option">
            <input type="radio" name="q18" value="auditory" />
            powtarzam sobie na gÅ‚os lub nagrywam
          </label>
          <label class="answer-option">
            <input type="radio" name="q18" value="kinesthetic" />
            ukÅ‚adam zadania fizycznie (karteczki)
          </label>
        </div>

        <div class="question-container" data-question="19">
          <div class="question-number">Pytanie 19 z 20</div>
          <h5 class="fw-bold mb-4">Na wykÅ‚adzie najlepiej uczÄ™ siÄ™ gdy:</h5>
          <label class="answer-option">
            <input type="radio" name="q19" value="visual" />
            mam prezentacjÄ™ i slajdy do podglÄ…du
          </label>
          <label class="answer-option">
            <input type="radio" name="q19" value="auditory" />
            sÅ‚ucham wykÅ‚adowcy i dyskusji
          </label>
          <label class="answer-option">
            <input type="radio" name="q19" value="kinesthetic" />
            mogÄ™ robiÄ‡ Ä‡wiczenia i eksperymenty
          </label>
        </div>

        <div class="question-container" data-question="20">
          <div class="question-number">Pytanie 20 z 20</div>
          <h5 class="fw-bold mb-4">Podczas nauki na egzamin wolÄ™:</h5>
          <label class="answer-option">
            <input type="radio" name="q20" value="visual" />
            czytaÄ‡ podrÄ™czniki i przeglÄ…daÄ‡ notatki
          </label>
          <label class="answer-option">
            <input type="radio" name="q20" value="auditory" />
            sÅ‚uchaÄ‡ nagraÅ„ lub dyskutowaÄ‡ z innymi
          </label>
          <label class="answer-option">
            <input type="radio" name="q20" value="kinesthetic" />
            robiÄ‡ quizy i rozwiÄ…zywaÄ‡ zadania praktyczne
          </label>
        </div>

        <div class="question-container" data-question="21">
          <div class="question-number">Dodatkowy opis</div>
          <h5 class="fw-bold mb-4">Opisz swoimi sÅ‚owami, jak najchÄ™tniej siÄ™ uczysz:</h5>
          <textarea class="form-control" name="userDescription" rows="5"
            placeholder="Np. LubiÄ™ oglÄ…daÄ‡ filmy edukacyjne i czytaÄ‡ ksiÄ…Å¼ki z ilustracjami..."></textarea>
          <div class="text-muted small mt-2">
            <i class="bi bi-info-circle"></i>
            Ten opis pomoÅ¼e AI lepiej okreÅ›liÄ‡ TwÃ³j styl uczenia
          </div>
        </div>

        <div class="navigation-buttons">
          <button type="button" class="btn btn-secondary btn-nav" id="prevBtn" onclick="changeQuestion(-1)">
            <i class="bi bi-arrow-left me-2"></i>Wstecz
          </button>
          
          <button type="button" class="btn btn-primary btn-nav" id="nextBtn" onclick="changeQuestion(1)">
            Dalej<i class="bi bi-arrow-right ms-2"></i>
          </button>
          <button type="submit" class="btn btn-accent btn-nav btn-bordered" id="submitBtn" style="display: none;">
            <i class="bi bi-check-circle me-2"></i>ZakoÅ„cz ankietÄ™
          </button>
        </div>
      </form>

      <div id="aiResult" class="d-none">
        <div class="alert alert-success text-center">
          <h4 class="mb-3"><i class="bi bi-check-circle-fill me-2"></i>Analiza zakoÅ„czona!</h4>
          <div id="aiOutput" class="fs-5"></div>
          <a href="/profil" class="btn btn-accent mt-3 btn-bordered">PrzejdÅº do profilu</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentQuestionIndex = 1;
    const totalQuestions = 21; // 20 pytaÅ„ + opis tekstowy

    // Toast notification system
    function showToast(message, duration = 5000) {
      const container = document.getElementById('toastContainer');

      const toast = document.createElement('div');
      toast.className = 'toast-notification';

      toast.innerHTML = `
          <div class="toast-logo">
            <img src="/img/logo-icon.png" alt="LearnEdge">
          </div>
          <div class="toast-message">${message}</div>
          <button class="toast-close" onclick="this.parentElement.remove()">
            <i class="bi bi-x"></i>
          </button>
        `;

      container.appendChild(toast);

      // Auto-hide after duration
      setTimeout(() => {
        toast.classList.add('toast-hide');
        setTimeout(() => toast.remove(), 400);
      }, duration);
    }

    // CSRF token
    function getCsrfToken() {
      const csrfMeta = document.querySelector('meta[name="_csrf"]');
      return csrfMeta ? csrfMeta.getAttribute('content') : '';
    }

    function getCsrfHeader() {
      const csrfHeaderMeta = document.querySelector('meta[name="_csrf_header"]');
      return csrfHeaderMeta ? csrfHeaderMeta.getAttribute('content') : 'X-CSRF-TOKEN';
    }

    // Nawigacja miÄ™dzy pytaniami
    function showQuestion(index) {
      document.querySelectorAll('.question-container').forEach(q => q.classList.remove('active'));
      const question = document.querySelector(`[data-question="${index}"]`);
      if (question) {
        question.classList.add('active');
        currentQuestionIndex = index;
        updateProgress();
        updateButtons();
      }
    }

    function changeQuestion(direction) {
      const newIndex = currentQuestionIndex + direction;
      if (newIndex >= 1 && newIndex <= totalQuestions) {
        showQuestion(newIndex);
      }
    }

    // Funkcja skipQuestion usuniÄ™ta, poniewaÅ¼ przycisk zostaÅ‚ usuniÄ™ty

    function updateProgress() {
      const progress = (currentQuestionIndex / totalQuestions) * 100;
      document.getElementById('progressBar').style.width = progress + '%';
      document.getElementById('currentQuestion').textContent = currentQuestionIndex;
      document.getElementById('totalQuestions').textContent = totalQuestions;
    }

    function updateButtons() {
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const submitBtn = document.getElementById('submitBtn');
      
      // UsuniÄ™to odwoÅ‚ania do skipBtn

      prevBtn.style.display = currentQuestionIndex === 1 ? 'none' : 'block';

      if (currentQuestionIndex === totalQuestions) {
        nextBtn.style.display = 'none';
        submitBtn.style.display = 'block';
      } else {
        nextBtn.style.display = 'block';
        submitBtn.style.display = 'none';
      }
    }

    // Zaznaczanie odpowiedzi
    document.querySelectorAll('.answer-option').forEach(option => {
      option.addEventListener('click', function (e) {
        // JeÅ›li klikniÄ™to bezpoÅ›rednio w radio button, nie rÃ³b nic (zostanie obsÅ‚uÅ¼one normalnie)
        if (e.target.tagName === 'INPUT') {
          return;
        }

        const radio = this.querySelector('input[type="radio"]');
        if (radio) {
          radio.checked = true;

          // UsuÅ„ selected z innych opcji w tej samej grupie
          const name = radio.name;
          document.querySelectorAll(`input[name="${name}"]`).forEach(r => {
            r.closest('.answer-option').classList.remove('selected');
          });
          this.classList.add('selected');
        }
      });
    });

    // ObsÅ‚uga bezpoÅ›redniego klikniÄ™cia w radio button
    document.querySelectorAll('.answer-option input[type="radio"]').forEach(radio => {
      radio.addEventListener('change', function () {
        const name = this.name;
        document.querySelectorAll(`input[name="${name}"]`).forEach(r => {
          r.closest('.answer-option').classList.remove('selected');
        });
        this.closest('.answer-option').classList.add('selected');
      });
    });

    // WysyÅ‚anie formularza
    document.getElementById('learningStyleForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const formData = new FormData(this);
      const surveyData = {};

      // Zbierz odpowiedzi z wszystkich pytaÅ„ (q1-q20)
      for (let i = 1; i <= 20; i++) {
        const answer = formData.get(`q${i}`);
        if (answer) {
          surveyData[`question${i}`] = answer;
        }
      }

      // Dodaj opis tekstowy
      const userDescription = formData.get("userDescription");
      if (userDescription && userDescription.trim()) {
        surveyData["userDescription"] = userDescription.trim();
      }

      const answeredQuestions = Object.keys(surveyData).filter(key => key.startsWith('question')).length;

      // Walidacja
      if (answeredQuestions === 0 && (!surveyData.userDescription || surveyData.userDescription.length < 10)) {
        showToast('ProszÄ™ odpowiedzieÄ‡ na przynajmniej jedno pytanie lub podaÄ‡ opis (min. 10 znakÃ³w).');
        return;
      }

      if (surveyData.userDescription && surveyData.userDescription.length > 0 && surveyData.userDescription.length < 10) {
        showToast('Opis jest zbyt krÃ³tki. ProszÄ™ wpisaÄ‡ minimum 10 znakÃ³w, aby AI mogÅ‚o go przeanalizowaÄ‡.');
        return;
      }

      try {
        const submitBtn = document.getElementById('submitBtn');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i> AnalizujÄ™...';
        submitBtn.disabled = true;

        const headers = {
          'Content-Type': 'application/json',
        };

        const csrfToken = getCsrfToken();
        if (csrfToken) {
          headers[getCsrfHeader()] = csrfToken;
        }

        const response = await fetch('/api/survey/analyze', {
          method: 'POST',
          headers: headers,
          body: JSON.stringify(surveyData)
        });

        const result = await response.json();

        if (result.success) {
          document.getElementById('learningStyleForm').classList.add('d-none');
          document.querySelector('.progress-bar-container').classList.add('d-none');
          document.getElementById('aiResult').classList.remove('d-none');
          let percentsHtml = '';
          if (result.percents) {
            percentsHtml = '<div class="mt-3">';
            percentsHtml += `<span class="me-3">Wzrokowy: <strong>${(result.percents.VISUAL ?? 0).toFixed(1)}%</strong></span>`;
            percentsHtml += `<span class="me-3">SÅ‚uchowy: <strong>${(result.percents.AUDITORY ?? 0).toFixed(1)}%</strong></span>`;
            percentsHtml += `<span class="me-3">Kinestetyczny: <strong>${(result.percents.KINESTHETIC ?? 0).toFixed(1)}%</strong></span>`;
            percentsHtml += '</div>';
          }
          // UsuÅ„ styl z komunikatu AI, pokazuj tylko tekst bez X
          const msg = result.message.replace(/: [^:]+$/, '');
          document.getElementById('aiOutput').innerHTML =
            `<strong class="text-accent">${msg}</strong>` + percentsHtml;

          // SprawdÅº czy jest remis
          const percents = result.percents;
          const percentValues = [percents.VISUAL ?? 0, percents.AUDITORY ?? 0, percents.KINESTHETIC ?? 0];
          const max = Math.max(...percentValues);
          const maxCount = percentValues.filter(v => v === max).length;
          // Remis: 2 lub 3 style majÄ… ten sam max
          if (maxCount > 1) {
            // Ukryj przycisk 'PrzejdÅº do profilu'
            const profileBtn = document.querySelector('#aiResult a.btn');
            if (profileBtn) profileBtn.style.display = 'none';
            setTimeout(() => {
              showRoulette(percentValues, max);
            }, 2000);
          }

          function showRoulette(percentValues, max) {
            // --- MODAL ---
            const rouletteModal = document.createElement('div');
            rouletteModal.id = 'rouletteModal';
            rouletteModal.style.position = 'fixed';
            rouletteModal.style.top = '0';
            rouletteModal.style.left = '0';
            rouletteModal.style.width = '100vw';
            rouletteModal.style.height = '100vh';
            rouletteModal.style.background = 'rgba(0,0,0,0.7)';
            rouletteModal.style.display = 'flex';
            rouletteModal.style.alignItems = 'center';
            rouletteModal.style.justifyContent = 'center';
            rouletteModal.style.zIndex = '9999';

            // Dane koÅ‚a
            const styles = ['ğŸ‘ï¸', 'ğŸ§', 'âœ‹'];
            const colors = ['#4fc3f7', '#ffd54f', '#81c784'];
            const gradients = [
              'url(#visualGrad)',
              'url(#auditoryGrad)',
              'url(#kinestheticGrad)'
            ];
            // Filtrujemy tylko te style, ktÃ³re majÄ… max wynik (remis)
            const activeIndexes = percentValues.map((v, i) => v === max ? i : -1).filter(i => i !== -1);
            const activeStyles = activeIndexes.map(i => styles[i]);
            const activeColors = activeIndexes.map(i => colors[i]);
            const activeGradients = activeIndexes.map(i => gradients[i]);

            // Losowanie zwyciÄ™zcy i pozycji w segmencie
            const winnerIdx = Math.floor(Math.random() * activeStyles.length);
            const numSegments = activeStyles.length;
            const anglePerSegment = 360 / numSegments;
            // Losujemy przesuniÄ™cie w obrÄ™bie segmentu (od Å›rodka - do +/- poÅ‚owy kÄ…ta segmentu)
            const offset = (Math.random() - 0.5) * anglePerSegment;

            // --- SVG KOÅA ---
            // UÅ¼ywamy grupy <g id="spinningPart"> do obracania tylko kolorowych elementÃ³w
            let wheelSVG = `<svg width="480" height="480" viewBox="0 0 480 480">
              <defs>
                <radialGradient id="wheelBgGrad" cx="50%" cy="50%" r="80%">
                  <stop offset="0%" stop-color="#fff" />
                  <stop offset="100%" stop-color="#e0f7fa" />
                </radialGradient>
                <radialGradient id="visualGrad" cx="50%" cy="50%" r="70%">
                  <stop offset="0%" stop-color="#b3e5fc" />
                  <stop offset="100%" stop-color="#4fc3f7" />
                </radialGradient>
                <radialGradient id="auditoryGrad" cx="50%" cy="50%" r="70%">
                  <stop offset="0%" stop-color="#fff9c4" />
                  <stop offset="100%" stop-color="#ffd54f" />
                </radialGradient>
                <radialGradient id="kinestheticGrad" cx="50%" cy="50%" r="70%">
                  <stop offset="0%" stop-color="#c8e6c9" />
                  <stop offset="100%" stop-color="#81c784" />
                </radialGradient>
                <filter id="shadow" x="-30%" y="-30%" width="160%" height="160%">
                  <feDropShadow dx="0" dy="8" stdDeviation="18" flood-color="#222" flood-opacity="0.25" />
                </filter>
                <filter id="emojiOutline" x="-10%" y="-10%" width="120%" height="120%">
                  <feDropShadow dx="0" dy="0" stdDeviation="2" flood-color="#fff" flood-opacity="1" />
                </filter>
                <filter id="logoShadow" x="-20%" y="-20%" width="140%" height="140%">
                  <feDropShadow dx="0" dy="2" stdDeviation="6" flood-color="#222" flood-opacity="0.3" />
                </filter>
              </defs>
              
              <circle cx="240" cy="240" r="220" fill="url(#wheelBgGrad)" filter="url(#shadow)" />
              
              <g id="spinningPart" style="transform-origin: 240px 240px; transform: rotate(-90deg); transition: transform 3s cubic-bezier(0.25, 1, 0.5, 1);">
                ${activeStyles.map((s, idx) => {
                  // Rysowanie segmentÃ³w
                  const startAngle = (idx / numSegments) * 2 * Math.PI;
                  const endAngle = ((idx + 1) / numSegments) * 2 * Math.PI;
                  const x1 = 240 + 210 * Math.cos(startAngle);
                  const y1 = 240 + 210 * Math.sin(startAngle);
                  const x2 = 240 + 210 * Math.cos(endAngle);
                  const y2 = 240 + 210 * Math.sin(endAngle);
                  const largeArcFlag = numSegments === 1 ? 1 : 0;
                  return `<path d="M240,240 L${x1},${y1} A210,210 0 ${largeArcFlag},1 ${x2},${y2} Z" fill="${activeGradients[idx]}" stroke="#222" stroke-width="6" />`;
                }).join('')}
                
                ${activeStyles.map((s, idx) => {
                  // Emotka
                  const angle = ((idx + 0.5) / activeStyles.length) * 2 * Math.PI;
                  const deg = (angle * 180 / Math.PI);
                  const x = 240 + 160 * Math.cos(angle);
                  const y = 240 + 160 * Math.sin(angle);
                  return `<text x="${x}" y="${y}" text-anchor="middle" alignment-baseline="middle" font-size="4em" font-weight="bold" fill="#222" filter="url(#emojiOutline)" style="transform-box: fill-box; transform-origin: center; transform: rotate(${deg}deg);">${s}</text>`;
                }).join('')}
              </g>

              <circle cx="240" cy="240" r="100" fill="#fff" stroke="#bbb" stroke-width="4" filter="url(#logoShadow)" />
              <image href="/img/logo-icon.png" x="190" y="190" width="100" height="100" />
            </svg>`;

            let wheelHTML = `<div style="background:#fff;padding:44px 32px 32px 32px;border-radius:36px;box-shadow:0 0 48px #222;text-align:center;min-width:520px;max-width:98vw;">
              <h3 style="margin-bottom:22px;font-size:2em;color:#333;">Remis! Losujemy styl uczenia siÄ™</h3>
              <div style="margin:0 auto;width:480px;height:480px;position:relative;">
                <div style="position:absolute;top:-48px;left:50%;transform:translateX(-50%);font-size:4em;color:#333;z-index:10;">â–¼</div>
                ${wheelSVG}
              </div>
              <div id="rouletteResult" style="margin-top:44px;font-size:2em;font-weight:bold; min-height: 3em; color:#333;"></div>
            </div>`;
            rouletteModal.innerHTML = wheelHTML;
            document.body.appendChild(rouletteModal);

            // --- ANIMACJA ---
            setTimeout(() => {
              // Celujemy teraz w grupÄ™ wewnÄ…trz SVG
              const spinningPart = document.getElementById('spinningPart');
              // KÄ…t docelowy: Å›rodek segmentu + losowe przesuniÄ™cie
              const winnerAngleCenter = (winnerIdx * anglePerSegment) + (anglePerSegment / 2) + offset;
              const extraSpins = 360 * 5; // 5 peÅ‚nych obrotÃ³w
              const targetRotation = extraSpins - winnerAngleCenter - 90;
              spinningPart.style.transform = `rotate(${targetRotation}deg)`;
            }, 100);

            // Po animacji (3 sekundy)
            setTimeout(() => {
              const pointerStyle = activeStyles[winnerIdx];
              const pointerColor = activeColors[winnerIdx];
              const resultDiv = document.getElementById('rouletteResult');
              let styleLabel = '';
              if (pointerStyle === 'ğŸ‘ï¸') styleLabel = 'Wzrokowiec';
              else if (pointerStyle === 'ğŸ§') styleLabel = 'SÅ‚uchowiec';
              else if (pointerStyle === 'âœ‹') styleLabel = 'Kinestetyk';
              resultDiv.innerHTML = `Wylosowano: <span style="color:${pointerColor}">${styleLabel} ${pointerStyle}</span>`;
              // WyÅ›lij styl do backendu zgodnie z emoji
              let backendStyle = '';
              if (pointerStyle === 'ğŸ‘ï¸') backendStyle = 'VISUAL';
              else if (pointerStyle === 'ğŸ§') backendStyle = 'AUDITORY';
              else if (pointerStyle === 'âœ‹') backendStyle = 'KINESTHETIC';
              fetch('/api/survey/set-style', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ style: backendStyle })
              })
                .then(res => res.json())
                .then(data => {
                  if (data.success) {
                    resultDiv.innerHTML += `<br><span style='color:green;font-size:0.8em;'>Zapisano!</span>`;
                  } else {
                    resultDiv.innerHTML += `<br><span style='color:red;font-size:0.8em;'>BÅ‚Ä…d zapisu!</span>`;
                  }
                })
                .catch(() => {
                  resultDiv.innerHTML += `<br><span style='color:red;font-size:0.8em;'>BÅ‚Ä…d sieci!</span>`;
                });
              // Zamknij po chwili
              setTimeout(() => {
                rouletteModal.remove();
                window.location.href = '/profil';
              }, 3000);
            }, 3100);
          }
        } else {
          showToast('BÅ‚Ä…d: ' + (result.error || 'Nie udaÅ‚o siÄ™ przeanalizowaÄ‡ ankiety'));
          submitBtn.innerHTML = originalText;
          submitBtn.disabled = false;
        }
      } catch (error) {
        console.error('BÅ‚Ä…d sieci:', error);
        showToast('WystÄ…piÅ‚ bÅ‚Ä…d podczas analizy. SprÃ³buj ponownie.');
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }
    });

    // Inicjalizacja
    updateProgress();
    updateButtons();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>